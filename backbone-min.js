(function(t,e){if(typeof exports==="object"){e(exports,require("underscore"),require("jquery"))}else if(typeof define==="function"&&define.amd){define("backbone",["exports","underscore","jquery"],e)}else{e(t,t._,t.jQuery||t.Zepto||t.ender||t.$)}})(this,function(t,e,i){var r=t.Backbone;var s=[];var n=s.push;var a=s.slice;var h=s.splice;var o;if(typeof exports!=="undefined"){o=exports}else{o=t.Backbone={}}o.VERSION="1.0.0";if(!e&&typeof require!=="undefined")e=require("underscore");o.$=i;o.noConflict=function(){t.Backbone=r;return this};o.emulateHTTP=false;o.emulateJSON=false;var u=o.Events={on:function(t,e,i){if(!c(this,"on",t,[e,i])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);r.push({callback:e,context:i,ctx:i||this});return this},once:function(t,i,r){if(!c(this,"once",t,[i,r])||!i)return this;var s=this;var n=e.once(function(){s.off(t,n);i.apply(this,arguments)});n._callback=i;return this.on(t,n,r)},off:function(t,i,r){var s,n,a,h,o,u,l,f;if(!this._events||!c(this,"off",t,[i,r]))return this;if(!t&&!i&&!r){this._events={};return this}h=t?[t]:e.keys(this._events);for(o=0,u=h.length;o<u;o++){t=h[o];if(a=this._events[t]){this._events[t]=s=[];if(i||r){for(l=0,f=a.length;l<f;l++){n=a[l];if(i&&i!==n.callback&&i!==n.callback._callback||r&&r!==n.context){s.push(n)}}}if(!s.length)delete this._events[t]}}return this},trigger:function(t){if(!this._events)return this;var e=a.call(arguments,1);if(!c(this,"trigger",t,e))return this;var i=this._events[t];var r=this._events.all;if(i)f(i,e);if(r)f(r,arguments);return this},stopListening:function(t,e,i){var r=this._listeners;if(!r)return this;var s=!e&&!i;if(typeof e==="object")i=this;if(t)(r={})[t._listenerId]=t;for(var n in r){r[n].off(e,i,this);if(s)delete this._listeners[n]}return this}};var l=/\s+/;var c=function(t,e,i,r){if(!i)return true;if(typeof i==="object"){for(var s in i){t[e].apply(t,[s,i[s]].concat(r))}return false}if(l.test(i)){var n=i.split(l);for(var a=0,h=n.length;a<h;a++){t[e].apply(t,[n[a]].concat(r))}return false}return true};var f=function(t,e){var i,r=-1,s=t.length,n=e[0],a=e[1],h=e[2];switch(e.length){case 0:while(++r<s)(i=t[r]).callback.call(i.ctx);return;case 1:while(++r<s)(i=t[r]).callback.call(i.ctx,n);return;case 2:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a);return;case 3:while(++r<s)(i=t[r]).callback.call(i.ctx,n,a,h);return;default:while(++r<s)(i=t[r]).callback.apply(i.ctx,e)}};var d={listenTo:"on",listenToOnce:"once"};e.each(d,function(t,i){u[i]=function(i,r,s){var n=this._listeners||(this._listeners={});var a=i._listenerId||(i._listenerId=e.uniqueId("l"));n[a]=i;if(typeof r==="object")s=this;i[t](r,s,this);return this}});u.bind=u.on;u.unbind=u.off;e.extend(o,u);var p=o.Model=function(t,i){var r;var s=t||{};i||(i={});this.cid=e.uniqueId("c");this.attributes={};if(i.collection)this.collection=i.collection;if(i.parse)s=this.parse(s,i)||{};i._attrs||(i._attrs=s);if(r=e.result(this,"defaults")){s=e.defaults({},s,r)}this.set(s,i);this.changed={};this.initialize.apply(this,arguments)};e.extend(p.prototype,u,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(t){return e.clone(this.attributes)},sync:function(){return o.sync.apply(this,arguments)},get:function(t){return this.attributes[t]},escape:function(t){return e.escape(this.get(t))},has:function(t){return this.get(t)!=null},set:function(t,i,r){var s,n,a,h,o,u,l,c;if(t==null)return this;if(typeof t==="object"){n=t;r=i}else{(n={})[t]=i}r||(r={});if(!this._validate(n,r))return false;a=r.unset;o=r.silent;h=[];u=this._changing;this._changing=true;if(!u){this._previousAttributes=e.clone(this.attributes);this.changed={}}c=this.attributes,l=this._previousAttributes;if(this.idAttribute in n)this.id=n[this.idAttribute];for(s in n){i=n[s];if(!e.isEqual(c[s],i))h.push(s);if(!e.isEqual(l[s],i)){this.changed[s]=i}else{delete this.changed[s]}a?delete c[s]:c[s]=i}if(!o){if(h.length)this._pending=true;for(var f=0,d=h.length;f<d;f++){this.trigger("change:"+h[f],this,c[h[f]],r)}}if(u)return this;if(!o){while(this._pending){this._pending=false;this.trigger("change",this,r)}}this._pending=false;this._changing=false;return this},unset:function(t,i){return this.set(t,void 0,e.extend({},i,{unset:true}))},clear:function(t){var i={};for(var r in this.attributes)i[r]=void 0;return this.set(i,e.extend({},t,{unset:true}))},hasChanged:function(t){if(t==null)return!e.isEmpty(this.changed);return e.has(this.changed,t)},changedAttributes:function(t){if(!t)return this.hasChanged()?e.clone(this.changed):false;var i,r=false;var s=this._changing?this._previousAttributes:this.attributes;for(var n in t){if(e.isEqual(s[n],i=t[n]))continue;(r||(r={}))[n]=i}return r},previous:function(t){if(t==null||!this._previousAttributes)return null;return this._previousAttributes[t]},previousAttributes:function(){return e.clone(this._previousAttributes)},fetch:function(t){t=t?e.clone(t):{};if(t.parse===void 0)t.parse=true;var i=this;var r=t.success;t.success=function(e){if(!i.set(i.parse(e,t),t))return false;if(r)r(i,e,t);i.trigger("sync",i,e,t)};q(this,t);return this.sync("read",this,t)},save:function(t,i,r){var s,n,a,h=this.attributes;if(t==null||typeof t==="object"){s=t;r=i}else{(s={})[t]=i}r=e.extend({validate:true},r);if(s&&!r.wait){if(!this.set(s,r))return false}else{if(!this._validate(s,r))return false}if(s&&r.wait){this.attributes=e.extend({},h,s)}if(r.parse===void 0)r.parse=true;var o=this;var u=r.success;r.success=function(t){o.attributes=h;var i=o.parse(t,r);if(r.wait)i=e.extend(s||{},i);if(e.isObject(i)&&!o.set(i,r)){return false}if(u)u(o,t,r);o.trigger("sync",o,t,r)};q(this,r);n=this.isNew()?"create":r.patch?"patch":"update";if(n==="patch")r.attrs=s;a=this.sync(n,this,r);if(s&&r.wait)this.attributes=h;return a},destroy:function(t){t=t?e.clone(t):{};var i=this;var r=t.success;var s=function(){i.trigger("destroy",i,i.collection,t)};t.success=function(e){if(t.wait||i.isNew())s();if(r)r(i,e,t);if(!i.isNew())i.trigger("sync",i,e,t)};if(this.isNew()){t.success();return false}q(this,t);var n=this.sync("delete",this,t);if(!t.wait)s();return n},url:function(){var t=e.result(this,"urlRoot")||e.result(this.collection,"url")||U();if(this.isNew())return t;return t+(t.charAt(t.length-1)==="/"?"":"/")+encodeURIComponent(this.id)},parse:function(t,e){return t},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},isValid:function(t){return this._validate({},e.extend(t||{},{validate:true}))},_validate:function(t,i){if(!i.validate||!this.validate)return true;t=e.extend({},this.attributes,t);var r=this.validationError=this.validate(t,i)||null;if(!r)return true;this.trigger("invalid",this,r,e.extend(i,{validationError:r}));return false}});var v=["keys","values","pairs","invert","pick","omit"];e.each(v,function(t){p.prototype[t]=function(){var i=a.call(arguments);i.unshift(this.attributes);return e[t].apply(e,i)}});var g=o.Collection=function(t,i){i||(i={});if(i.model)this.model=i.model;if(i.comparator!==void 0)this.comparator=i.comparator;this._reset();this.initialize.apply(this,arguments);if(t)this.reset(t,e.extend({silent:true},i))};var m={add:true,remove:true,merge:true};var y={add:true,remove:false};e.extend(g.prototype,u,{model:p,initialize:function(){},toJSON:function(t){return this.map(function(e){return e.toJSON(t)})},sync:function(){return o.sync.apply(this,arguments)},add:function(t,i){return this.set(t,e.extend({merge:false},i,y))},remove:function(t,i){t=e.isArray(t)?t.slice():[t];i||(i={});var r,s,n,a;for(r=0,s=t.length;r<s;r++){a=this.get(t[r]);if(!a)continue;delete this._byId[a.id];delete this._byId[a.cid];n=this.indexOf(a);this.models.splice(n,1);this.length--;if(!i.silent){i.index=n;a.trigger("remove",a,this,i)}this._removeReference(a)}return this},set:function(t,i){i=e.defaults({},i,m);if(i.parse)t=this.parse(t,i);if(!e.isArray(t))t=t?[t]:[];var r,s,a,o,u,l;var c=i.at;var f=this.comparator&&c==null&&i.sort!==false;var d=e.isString(this.comparator)?this.comparator:null;var p=[],v=[],g={};var y=i.add,_=i.merge,b=i.remove;var w=!f&&y&&b?[]:false;for(r=0,s=t.length;r<s;r++){if(!(a=this._prepareModel(o=t[r],i)))continue;if(u=this.get(a)){if(b)g[u.cid]=true;if(_){o=o===a?a.attributes:i._attrs;u.set(o,i);if(f&&!l&&u.hasChanged(d))l=true}}else if(y){p.push(a);a.on("all",this._onModelEvent,this);this._byId[a.cid]=a;if(a.id!=null)this._byId[a.id]=a}if(w)w.push(u||a);delete i._attrs}if(b){for(r=0,s=this.length;r<s;++r){if(!g[(a=this.models[r]).cid])v.push(a)}if(v.length)this.remove(v,i)}if(p.length||w&&w.length){if(f)l=true;this.length+=p.length;if(c!=null){h.apply(this.models,[c,0].concat(p))}else{if(w)this.models.length=0;n.apply(this.models,w||p)}}if(l)this.sort({silent:true});if(i.silent)return this;for(r=0,s=p.length;r<s;r++){(a=p[r]).trigger("add",a,this,i)}if(l||w&&w.length)this.trigger("sort",this,i);return this},reset:function(t,i){i||(i={});for(var r=0,s=this.models.length;r<s;r++){this._removeReference(this.models[r])}i.previousModels=this.models;this._reset();this.add(t,e.extend({silent:true},i));if(!i.silent)this.trigger("reset",this,i);return this},push:function(t,i){t=this._prepareModel(t,i);this.add(t,e.extend({at:this.length},i));return t},pop:function(t){var e=this.at(this.length-1);this.remove(e,t);return e},unshift:function(t,i){t=this._prepareModel(t,i);this.add(t,e.extend({at:0},i));return t},shift:function(t){var e=this.at(0);this.remove(e,t);return e},slice:function(){return a.apply(this.models,arguments)},get:function(t){if(t==null)return void 0;return this._byId[t.id]||this._byId[t.cid]||this._byId[t]},at:function(t){return this.models[t]},where:function(t,i){if(e.isEmpty(t))return i?void 0:[];return this[i?"find":"filter"](function(e){for(var i in t){if(t[i]!==e.get(i))return false}return true})},findWhere:function(t){return this.where(t,true)},sort:function(t){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");t||(t={});if(e.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(e.bind(this.comparator,this))}if(!t.silent)this.trigger("sort",this,t);return this},sortedIndex:function(t,i,r){i||(i=this.comparator);var s=e.isFunction(i)?i:function(t){return t.get(i)};return e.sortedIndex(this.models,t,s,r)},pluck:function(t){return e.invoke(this.models,"get",t)},fetch:function(t){t=t?e.clone(t):{};if(t.parse===void 0)t.parse=true;var i=t.success;var r=this;t.success=function(e){var s=t.reset?"reset":"set";r[s](e,t);if(i)i(r,e,t);r.trigger("sync",r,e,t)};q(this,t);return this.sync("read",this,t)},create:function(t,i){i=i?e.clone(i):{};if(!(t=this._prepareModel(t,i)))return false;if(!i.wait)this.add(t,i);var r=this;var s=i.success;i.success=function(t,e,i){if(i.wait)r.add(t,i);if(s)s(t,e,i)};t.save(null,i);return t},parse:function(t,e){return t},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(t,e){if(t instanceof p){if(!t.collection)t.collection=this;return t}e||(e={});e.collection=this;var i=new this.model(t,e);if(!i.validationError)return i;this.trigger("invalid",this,t,e);return false},_removeReference:function(t){if(this===t.collection)delete t.collection;t.off("all",this._onModelEvent,this)},_onModelEvent:function(t,e,i,r){if((t==="add"||t==="remove")&&i!==this)return;if(t==="destroy")this.remove(e,r);if(e&&t==="change:"+e.idAttribute){delete this._byId[e.previous(e.idAttribute)];if(e.id!=null)this._byId[e.id]=e}this.trigger.apply(this,arguments)}});var _=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];e.each(_,function(t){g.prototype[t]=function(){var i=a.call(arguments);i.unshift(this.models);return e[t].apply(e,i)}});var b=["groupBy","countBy","sortBy"];e.each(b,function(t){g.prototype[t]=function(i,r){var s=e.isFunction(i)?i:function(t){return t.get(i)};return e[t](this.models,s,r)}});var w=o.View=function(t){this.cid=e.uniqueId("view");t||(t={});e.extend(this,e.pick(t,E));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var x=/^(\S+)\s*(.*)$/;var E=["model","collection","el","id","attributes","className","tagName","events"];e.extend(w.prototype,u,{tagName:"div",$:function(t){return this.$el.find(t)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(t,e){if(this.$el)this.undelegateEvents();this.$el=t instanceof o.$?t:o.$(t);this.el=this.$el[0];if(e!==false)this.delegateEvents();return this},delegateEvents:function(t){if(!(t||(t=e.result(this,"events"))))return this;this.undelegateEvents();for(var i in t){var r=t[i];if(!e.isFunction(r))r=this[t[i]];if(!r)continue;var s=i.match(x);var n=s[1],a=s[2];r=e.bind(r,this);n+=".delegateEvents"+this.cid;if(a===""){this.$el.on(n,r)}else{this.$el.on(n,a,r)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var t=e.extend({},e.result(this,"attributes"));if(this.id)t.id=e.result(this,"id");if(this.className)t["class"]=e.result(this,"className");var i=o.$("<"+e.result(this,"tagName")+">").attr(t);this.setElement(i,false)}else{this.setElement(e.result(this,"el"),false)}}});o.sync=function(t,i,r){var s=S[t];e.defaults(r||(r={}),{emulateHTTP:o.emulateHTTP,emulateJSON:o.emulateJSON});var n={type:s,dataType:"json"};if(!r.url){n.url=e.result(i,"url")||U()}if(r.data==null&&i&&(t==="create"||t==="update"||t==="patch")){n.contentType="application/json";n.data=JSON.stringify(r.attrs||i.toJSON(r))}if(r.emulateJSON){n.contentType="application/x-www-form-urlencoded";n.data=n.data?{model:n.data}:{}}if(r.emulateHTTP&&(s==="PUT"||s==="DELETE"||s==="PATCH")){n.type="POST";if(r.emulateJSON)n.data._method=s;var a=r.beforeSend;r.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",s);if(a)return a.apply(this,arguments)}}if(n.type!=="GET"&&!r.emulateJSON){n.processData=false}if(n.type==="PATCH"&&k){n.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var h=r.xhr=o.ajax(e.extend(n,r));i.trigger("request",i,h,r);return h};var k=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var S={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};o.ajax=function(){return o.$.ajax.apply(o.$,arguments)};var $=o.Router=function(t){t||(t={});if(t.routes)this.routes=t.routes;this._bindRoutes();this.initialize.apply(this,arguments)};var T=/\((.*?)\)/g;var H=/(\(\?)?:\w+/g;var I=/\*\w+/g;var A=/[\-{}\[\]+?.,\\\^$|#\s]/g;e.extend($.prototype,u,{initialize:function(){},route:function(t,i,r){if(!e.isRegExp(t))t=this._routeToRegExp(t);if(e.isFunction(i)){r=i;i=""}if(!r)r=this[i];var s=this;o.history.route(t,function(e){var n=s._extractParameters(t,e);r&&r.apply(s,n);s.trigger.apply(s,["route:"+i].concat(n));s.trigger("route",i,n);o.history.trigger("route",s,i,n)});return this},navigate:function(t,e){o.history.navigate(t,e);return this},_bindRoutes:function(){if(!this.routes)return;this.routes=e.result(this,"routes");var t,i=e.keys(this.routes);while((t=i.pop())!=null){this.route(t,this.routes[t])}},_routeToRegExp:function(t){t=t.replace(A,"\\$&").replace(T,"(?:$1)?").replace(H,function(t,e){return e?t:"([^/]+)"}).replace(I,"(.*?)");return new RegExp("^"+t+"$")},_extractParameters:function(t,i){var r=t.exec(i).slice(1);return e.map(r,function(t){return t?decodeURIComponent(t):null})}});var N=o.History=function(){this.handlers=[];e.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var O=/^[#\/]|\s+$/g;var P=/^\/+|\/+$/g;var j=/msie [\w.]+/;var C=/\/$/;N.started=false;e.extend(N.prototype,u,{interval:50,getHash:function(t){var e=(t||this).location.href.match(/#(.*)$/);return e?e[1]:""},getFragment:function(t,e){if(t==null){if(this._hasPushState||!this._wantsHashChange||e){t=this.location.pathname;var i=this.root.replace(C,"");if(!t.indexOf(i))t=t.slice(i.length)}else{t=this.getHash()}}return t.replace(O,"")},start:function(t){if(N.started)throw new Error("Backbone.history has already been started");N.started=true;this.options=e.extend({},{root:"/"},this.options,t);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment();var r=document.documentMode;var s=j.exec(navigator.userAgent.toLowerCase())&&(!r||r<=7);this.root=("/"+this.root+"/").replace(P,"/");if(s&&this._wantsHashChange){this.iframe=o.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow;this.navigate(i)}if(this._hasPushState){o.$(window).on("popstate",this.checkUrl)}else if(this._wantsHashChange&&"onhashchange"in window&&!s){o.$(window).on("hashchange",this.checkUrl)}else if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}this.fragment=i;var n=this.location;var a=n.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!a){this.fragment=this.getFragment(null,true);this.location.replace(this.root+this.location.search+"#"+this.fragment);return true}else if(this._hasPushState&&a&&n.hash){this.fragment=this.getHash().replace(O,"");this.history.replaceState({},document.title,this.root+this.fragment+n.search)}}if(!this.options.silent)return this.loadUrl()},stop:function(){o.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);N.started=false},route:function(t,e){this.handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();if(e===this.fragment&&this.iframe){e=this.getFragment(this.getHash(this.iframe))}if(e===this.fragment)return false;if(this.iframe)this.navigate(e);this.loadUrl()},loadUrl:function(t){var i=this.fragment=this.getFragment(t);return e.any(this.handlers,function(t){if(t.route.test(i)){t.callback(i);return true}})},navigate:function(t,e){if(!N.started)return false;if(!e||e===true)e={trigger:!!e};t=this.getFragment(t||"");if(this.fragment===t)return;this.fragment=t;var i=this.root+t;if(t===""&&i!=="/")i=i.slice(0,-1);if(this._hasPushState){this.history[e.replace?"replaceState":"pushState"]({},document.title,i)}else if(this._wantsHashChange){this._updateHash(this.location,t,e.replace);if(this.iframe&&t!==this.getFragment(this.getHash(this.iframe))){if(!e.replace)this.iframe.document.open().close();this._updateHash(this.iframe.location,t,e.replace)}}else{return this.location.assign(i)}if(e.trigger)return this.loadUrl(t)},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else{t.hash="#"+e}}});o.history=new N;var R=function(t,i){var r=this;var s;if(t&&e.has(t,"constructor")){s=t.constructor}else{s=function(){return r.apply(this,arguments)}}e.extend(s,r,i);var n=function(){this.constructor=s};n.prototype=r.prototype;s.prototype=new n;if(t)e.extend(s.prototype,t);s.__super__=r.prototype;return s};p.extend=g.extend=$.extend=w.extend=N.extend=R;var U=function(){throw new Error('A "url" property or function must be specified')};var q=function(t,e){var i=e.error;e.error=function(r){if(i)i(t,r,e);t.trigger("error",t,r,e)}};return o});
//@ sourceMappingURL=backbone-min.map