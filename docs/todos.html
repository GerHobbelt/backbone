<!DOCTYPE html>  <html> <head>   <title>todos.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <ul id="jump_to">         <li>           <a class="large" href="javascript:void(0);">Jump To &hellip;</a>           <a class="small" href="javascript:void(0);">+</a>           <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="backbone.localStorage.html">                 backbone.localStorage.js               </a>                                           <a class="source" href="todos.html">                 todos.js               </a>                        </div>         </li>       </ul>          <ul class="sections">           <li id="title">             <div class="annotation">                 <h1>todos.js</h1>             </div>         </li>                              <li id="section-1">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                           <p>An example Backbone application contributed by
<a href="http://jgn.me/">Jérôme Gravel-Niquet</a>. This demo uses a simple
<a href="backbone.localStorage.html">LocalStorage adapter</a>
to persist Backbone models within your browser.</p>

             </div>                      </li>                              <li id="section-2">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>                           

<p>Load the application once the DOM is ready, using <code>jQuery.ready</code>:</p>

             </div>                          <div class="content"><div class="highlight"><pre>$(function(){

</pre></div></div>                      </li>                              <li id="section-3">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>                           

<h2>Todo Model</h2>

             </div>                      </li>                              <li id="section-4">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>                           

<p>Our basic <strong>Todo</strong> model has <code>title</code>, <code>order</code>, and <code>done</code> attributes.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  var Todo = Backbone.Model.extend({

</pre></div></div>                      </li>                              <li id="section-5">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>                           

<p>Default attributes for the todo item.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    defaults: function() {
      return {
        title: &quot;empty todo...&quot;,
        order: Todos.nextOrder(),
        done: false
      };
    },

</pre></div></div>                      </li>                              <li id="section-6">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>                           

<p>Toggle the <code>done</code> state of this todo item.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    toggle: function() {
      this.save({done: !this.get(&quot;done&quot;)});
    }

  });

</pre></div></div>                      </li>                              <li id="section-7">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>                           

<h2>Todo Collection</h2>

             </div>                      </li>                              <li id="section-8">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>                           

<p>The collection of todos is backed by <em>localStorage</em> instead of a remote
server.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  var TodoList = Backbone.Collection.extend({

</pre></div></div>                      </li>                              <li id="section-9">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>                           

<p>Reference to this collection's model.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    model: Todo,

</pre></div></div>                      </li>                              <li id="section-10">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>                           

<p>Save all of the todo items under the <code>"todos-backbone"</code> namespace.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    localStorage: new Backbone.LocalStorage(&quot;todos-backbone&quot;),

</pre></div></div>                      </li>                              <li id="section-11">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>                           

<p>Filter down the list of all todo items that are finished.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    done: function() {
      return this.where({done: true});
    },

</pre></div></div>                      </li>                              <li id="section-12">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>                           

<p>Filter down the list to only todo items that are still not finished.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    remaining: function() {
      return this.where({done: false});
    },

</pre></div></div>                      </li>                              <li id="section-13">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>                           

<p>We keep the Todos in sequential order, despite being saved by unordered
GUID in the database. This generates the next order number for new items.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    nextOrder: function() {
      if (!this.length) return 1;
      return this.last().get(&#x27;order&#x27;) + 1;
    },

</pre></div></div>                      </li>                              <li id="section-14">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>                           

<p>Todos are sorted by their original insertion order.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    comparator: &#x27;order&#x27;

  });

</pre></div></div>                      </li>                              <li id="section-15">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>                           

<p>Create our global collection of <strong>Todos</strong>.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  var Todos = new TodoList;

</pre></div></div>                      </li>                              <li id="section-16">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>                           

<h2>Todo Item View</h2>

             </div>                      </li>                              <li id="section-17">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>                           

<p>The DOM element for a todo item...</p>

             </div>                          <div class="content"><div class="highlight"><pre>  var TodoView = Backbone.View.extend({

</pre></div></div>                      </li>                              <li id="section-18">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>                           

<p>... is a list tag.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    tagName:  &quot;li&quot;,

</pre></div></div>                      </li>                              <li id="section-19">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>                           

<p>Cache the template function for a single item.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    template: _.template($(&#x27;#item-template&#x27;).html()),

</pre></div></div>                      </li>                              <li id="section-20">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>                           

<p>The DOM events specific to an item.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    events: {
      &quot;click .toggle&quot;   : &quot;toggleDone&quot;,
      &quot;dblclick .view&quot;  : &quot;edit&quot;,
      &quot;click a.destroy&quot; : &quot;clear&quot;,
      &quot;keypress .edit&quot;  : &quot;updateOnEnter&quot;,
      &quot;blur .edit&quot;      : &quot;close&quot;
    },

</pre></div></div>                      </li>                              <li id="section-21">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>                           

<p>The TodoView listens for changes to its model, re-rendering. Since there's
a one-to-one correspondence between a <strong>Todo</strong> and a <strong>TodoView</strong> in this
app, we set a direct reference on the model for convenience.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    initialize: function() {
      this.listenTo(this.model, &#x27;change&#x27;, this.render);
      this.listenTo(this.model, &#x27;destroy&#x27;, this.remove);
    },

</pre></div></div>                      </li>                              <li id="section-22">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>                           

<p>Re-render the titles of the todo item.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    render: function() {
      this.$el.html(this.template(this.model.toJSON()));
      this.$el.toggleClass(&#x27;done&#x27;, this.model.get(&#x27;done&#x27;));
      this.input = this.$(&#x27;.edit&#x27;);
      return this;
    },

</pre></div></div>                      </li>                              <li id="section-23">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>                           

<p>Toggle the <code>"done"</code> state of the model.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    toggleDone: function() {
      this.model.toggle();
    },

</pre></div></div>                      </li>                              <li id="section-24">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>                           

<p>Switch this view into <code>"editing"</code> mode, displaying the input field.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    edit: function() {
      this.$el.addClass(&quot;editing&quot;);
      this.input.focus();
    },

</pre></div></div>                      </li>                              <li id="section-25">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>                           

<p>Close the <code>"editing"</code> mode, saving changes to the todo.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    close: function() {
      var value = this.input.val();
      if (!value) {
        this.clear();
      } else {
        this.model.save({title: value});
        this.$el.removeClass(&quot;editing&quot;);
      }
    },

</pre></div></div>                      </li>                              <li id="section-26">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>                           

<p>If you hit <code>enter</code>, we're through editing the item.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    updateOnEnter: function(e) {
      if (e.keyCode == 13) this.close();
    },

</pre></div></div>                      </li>                              <li id="section-27">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>                           

<p>Remove the item, destroy the model.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    clear: function() {
      this.model.destroy();
    }

  });

</pre></div></div>                      </li>                              <li id="section-28">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>                           

<h2>The Application</h2>

             </div>                      </li>                              <li id="section-29">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>                           

<p>Our overall <strong>AppView</strong> is the top-level piece of UI.</p>

             </div>                          <div class="content"><div class="highlight"><pre>  var AppView = Backbone.View.extend({

</pre></div></div>                      </li>                              <li id="section-30">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>                           

<p>Instead of generating a new element, bind to the existing skeleton of
the App already present in the HTML.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    el: $(&quot;#todoapp&quot;),

</pre></div></div>                      </li>                              <li id="section-31">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>                           

<p>Our template for the line of statistics at the bottom of the app.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    statsTemplate: _.template($(&#x27;#stats-template&#x27;).html()),

</pre></div></div>                      </li>                              <li id="section-32">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>                           

<p>Delegated events for creating new items, and clearing completed ones.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    events: {
      &quot;keypress #new-todo&quot;:  &quot;createOnEnter&quot;,
      &quot;click #clear-completed&quot;: &quot;clearCompleted&quot;,
      &quot;click #toggle-all&quot;: &quot;toggleAllComplete&quot;
    },

</pre></div></div>                      </li>                              <li id="section-33">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>                           

<p>At initialization we bind to the relevant events on the <code>Todos</code>
collection, when items are added or changed. Kick things off by
loading any preexisting todos that might be saved in <em>localStorage</em>.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    initialize: function() {

      this.input = this.$(&quot;#new-todo&quot;);
      this.allCheckbox = this.$(&quot;#toggle-all&quot;)[0];

      this.listenTo(Todos, &#x27;add&#x27;, this.addOne);
      this.listenTo(Todos, &#x27;reset&#x27;, this.addAll);
      this.listenTo(Todos, &#x27;all&#x27;, this.render);

      this.footer = this.$(&#x27;footer&#x27;);
      this.main = $(&#x27;#main&#x27;);

      Todos.fetch();
    },

</pre></div></div>                      </li>                              <li id="section-34">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>                           

<p>Re-rendering the App just means refreshing the statistics -- the rest
of the app doesn't change.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    render: function() {
      var done = Todos.done().length;
      var remaining = Todos.remaining().length;

      if (Todos.length) {
        this.main.show();
        this.footer.show();
        this.footer.html(this.statsTemplate({done: done, remaining: remaining}));
      } else {
        this.main.hide();
        this.footer.hide();
      }

      this.allCheckbox.checked = !remaining;
    },

</pre></div></div>                      </li>                              <li id="section-35">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>                           

<p>Add a single todo item to the list by creating a view for it, and
appending its element to the <code>&lt;ul&gt;</code>.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    addOne: function(todo) {
      var view = new TodoView({model: todo});
      this.$(&quot;#todo-list&quot;).append(view.render().el);
    },

</pre></div></div>                      </li>                              <li id="section-36">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>                           

<p>Add all items in the <strong>Todos</strong> collection at once.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    addAll: function() {
      Todos.each(this.addOne, this);
    },

</pre></div></div>                      </li>                              <li id="section-37">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>                           

<p>If you hit return in the main input field, create new <strong>Todo</strong> model,
persisting it to <em>localStorage</em>.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    createOnEnter: function(e) {
      if (e.keyCode != 13) return;
      if (!this.input.val()) return;

      Todos.create({title: this.input.val()});
      this.input.val(&#x27;&#x27;);
    },

</pre></div></div>                      </li>                              <li id="section-38">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>                           

<p>Clear all done todo items, destroying their models.</p>

             </div>                          <div class="content"><div class="highlight"><pre>    clearCompleted: function() {
      _.invoke(Todos.done(), &#x27;destroy&#x27;);
      return false;
    },

    toggleAllComplete: function () {
      var done = this.allCheckbox.checked;
      Todos.each(function (todo) { todo.save({&#x27;done&#x27;: done}); });
    }

  });

</pre></div></div>                      </li>                              <li id="section-39">             <div class="annotation">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>                           

<p>Finally, we kick things off by creating the <strong>App</strong>.</p>             </div>                          <div class="content"><div class="highlight"><pre>  var App = new AppView;

});

</pre></div></div>                      </li>              </ul>    </div> </body> </html> 